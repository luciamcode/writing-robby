<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>å’Œé¢¨ åŸ·ç­†ãƒé–“</title>
<script>
// â–  ã‚¨ãƒ©ãƒ¼é€šçŸ¥æ©Ÿèƒ½ï¼ˆå‹•ã‹ãªã„åŸå› ã‚’ç”»é¢ã«å‡ºã™ï¼‰
window.onerror = function(msg, url, lineNo, columnNo, error) {
    alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\n" + msg + "\nè¡Œ: " + lineNo);
    return false;
};
</script>
<style>
    :root {
        --bg: #fcfaf2; --text: #2b2b2b; --bar: #fdfdfd; --border: #dcd3b2;
        --accent: #165e83; --select-bg: #e3eff7; --danger: #b7282e;
    }
    body.dark {
        --bg: #202124; --text: #e8eaed; --bar: #303134; --border: #5f6368;
        --accent: #8ab4f8; --select-bg: #3c4043; --danger: #f28b82;
    }
    body {
        font-family: "Yu Mincho", serif; background: var(--bg); color: var(--text);
        margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden;
    }
    button { border: none; background: none; font-family: inherit; cursor: pointer; color: inherit; }
    
    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .header {
        height: 50px; background: var(--bar); border-bottom: 1px solid var(--border);
        display: flex; align-items: center; padding: 0 10px; justify-content: space-between;
    }
    .tabs { background: rgba(0,0,0,0.05); border-radius: 6px; padding: 2px; display: flex; }
    .tab { padding: 4px 12px; font-size: 14px; color: #888; border-radius: 4px; }
    .tab.active { background: var(--bg); color: var(--accent); font-weight: bold; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
    
    /* ãƒ¡ã‚¤ãƒ³ */
    #main { flex: 1; overflow: hidden; position: relative; }
    #list-view { height: 100%; overflow-y: auto; padding: 10px 10px 60px 10px; }
    #novel-view { height: 100%; display: none; padding: 10px; }
    #novel-text { width: 100%; height: 100%; border: none; background: transparent; color: var(--text); font-size: 16px; line-height: 1.8; resize: none; outline: none; }
    
    /* ãƒªã‚¹ãƒˆ */
    ul { list-style: none; padding: 0; margin: 0; }
    ul ul { padding-left: 20px; border-left: 1px dashed var(--border); margin-top: 2px; }
    .node { margin-bottom: 4px; }
    .node-content {
        display: flex; align-items: flex-start; background: var(--bar);
        border: 1px solid transparent; border-radius: 4px; padding: 6px 4px;
    }
    .node-content.selected { background: var(--select-bg); border-color: var(--accent); }
    textarea.row-text {
        flex: 1; border: none; background: transparent; color: var(--text);
        font-size: 16px; line-height: 1.5; resize: none; outline: none; min-height: 24px;
        font-family: inherit; padding: 0; margin-left: 5px;
    }
    
    /* ãƒ•ãƒƒã‚¿ãƒ¼ */
    .footer {
        height: 50px; background: var(--bar); border-top: 1px solid var(--border);
        display: flex; justify-content: space-around; align-items: center;
    }
    .f-btn {
        flex: 1; height: 100%; display: flex; flex-direction: column; 
        justify-content: center; align-items: center; font-size: 10px; color: #666;
    }
    .f-icon { font-size: 18px; margin-bottom: 2px; }
    
    /* ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿è¡¨ç¤º */
    .view-select { display: none; width: 100%; background: var(--select-bg); }
    body.mode-select .view-normal { display: none; }
    body.mode-select .view-select { display: flex; }
    
    /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ */
    .check { display: none; margin-top: 5px; font-size: 14px; color: var(--accent); }
    body.mode-select .check { display: block; }
    
    /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
    .menu {
        position: absolute; top: 50px; right: 10px; width: 180px;
        background: var(--bar); border: 1px solid var(--border);
        display: none; flex-direction: column; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 100;
    }
    .menu.show { display: flex; }
    .menu-item { padding: 12px; border-bottom: 1px solid var(--border); font-size: 14px; }
</style>
</head>
<body>

<div class="header">
    <div class="tabs">
        <button class="tab active" onclick="app.setTab('list')">æ§‹æˆ</button>
        <button class="tab" onclick="app.setTab('novel')">å°èª¬</button>
    </div>
    <div style="font-size:12px; color:#888; margin-right:10px;"><span id="count">0</span>å­—</div>
    <button onclick="app.toggleMenu()" style="font-size:20px;">ï¸™</button>
</div>

<div class="menu" id="menu">
    <button class="menu-item" onclick="app.toggleDark()">ğŸŒ™ ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</button>
    <button class="menu-item" onclick="app.download()">â¬‡ ä¿å­˜(DL)</button>
    <button class="menu-item" onclick="document.getElementById('file').click()">ğŸ“‚ èª­è¾¼</button>
    <button class="menu-item" onclick="app.reset()" style="color:var(--danger)">ğŸ—‘ å…¨æ¶ˆå»</button>
</div>

<div id="main">
    <div id="list-view"><ul id="root"></ul></div>
    <div id="novel-view"><textarea id="novel-text" oninput="app.save()" placeholder="ã“ã“ã«æœ¬æ–‡ã‚’æ›¸ã..."></textarea></div>
</div>

<div class="footer">
    <div class="view-normal" style="display:flex; width:100%;">
        <button class="f-btn" onclick="app.indent(-1)"><span class="f-icon">âª</span>å­—ä¸Šã’</button>
        <button class="f-btn" onclick="app.indent(1)"><span class="f-icon">â©</span>å­—ä¸‹ã’</button>
        <button class="f-btn" onclick="app.add()" style="color:var(--accent)"><span class="f-icon">â•</span>è¿½åŠ </button>
        <button class="f-btn" onclick="app.toggleSelect()"><span class="f-icon">âœ…</span>é¸æŠ</button>
    </div>
    <div class="view-select">
        <button class="f-btn" onclick="app.move(-1)"><span class="f-icon">â¬†</span>ä¸Šã¸</button>
        <button class="f-btn" onclick="app.move(1)"><span class="f-icon">â¬‡</span>ä¸‹ã¸</button>
        <button class="f-btn" onclick="app.copy()"><span class="f-icon">ğŸ“„</span>è¤‡è£½</button>
        <button class="f-btn" onclick="app.del()" style="color:var(--danger)"><span class="f-icon">ğŸ—‘</span>å‰Šé™¤</button>
        <button class="f-btn"
